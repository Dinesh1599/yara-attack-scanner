rule Exploit_Generic_Web_Attack {
    meta:
        description = "Detects generic web exploit patterns (RCE, LFI, etc.)"
        author = "Dinesh"
        reference = "https://attack.mitre.org/techniques/T1190/"
        severity = "high"
        mitre_attack_id = "T1190"
    
    strings:
        // Improved patterns based on real attacks
        $rce1 = /cmd\.exe\s+\/c\s+power(shell|sh)/ nocase
        $rce2 = /wget\s+(http|https):\/\/.*\/(payload|exploit)/ nocase
        $lfi = /(\.\.\/)+etc\/passwd/ nocase
    
    condition:
        any of them and filesize < 2MB
}

rule Log4Shell_Exploit {
    meta:
        description = "Detects Log4Shell (CVE-2021-44228) exploitation attempts"
        author = "Dinesh"
        reference = "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228"
        severity = "critical"
        mitre_attack_id = "T1190"
    
    strings:
        // Expanded JNDI patterns with common obfuscation variants
        $jndi_ldap = /\$\{jndi:(ldap[s]?|rmi|dns):\/\// nocase
        $jndi_http = /\$\{jndi:http:\/\// nocase
        $jndi_env = /\$\{(\${|lower:|upper:)*jndi:/ nocase
    
    condition:
        any of them
}