rule RAT_Generic_Behavior {
    meta:
        description = "Detects generic Remote Access Trojan behaviors"
        author = "Security Team"
        reference = "https://attack.mitre.org/techniques/T1219/"
        severity = "high"
        mitre_attack_id = "T1219"
    
    strings:
        $s1 = "CreateRemoteThread" fullword ascii
        $s2 = "VirtualAllocEx" fullword ascii
        $s3 = "WriteProcessMemory" fullword ascii
        $s4 = "cmd.exe /c" fullword ascii
    
    condition:
        3 of them and filesize < 5MB
}

rule PowerShell_Suspicious_Command {
    meta:
        description = "Detects suspicious PowerShell commands often used in attacks"
        author = "Security Team"
        reference = "https://attack.mitre.org/techniques/T1059/001/"
        severity = "high"
        mitre_attack_id = "T1059.001"
    
    strings:
        $ps1 = "-nop -w hidden -enc" nocase
        $ps2 = "Invoke-Expression" nocase
        $ps3 = "DownloadString" nocase
        $ps4 = "New-Object Net.WebClient" nocase
    
    condition:
        2 of them
}

rule Cobalt_Strike_Artifacts {
    meta:
        description = "Detects Cobalt Strike beacon artifacts"
        author = "Security Team"
        reference = "https://attack.mitre.org/software/S0154/"
        severity = "critical"
        mitre_attack_id = "S0154"
    
    strings:
        $beacon1 = "beacon.dll" nocase wide
        $beacon2 = "beacon.x64.dll" nocase wide
        $beacon3 = "ReflectiveLoader" wide
        $beacon4 = "beacon.http-get" wide
    
    condition:
        any of them
}